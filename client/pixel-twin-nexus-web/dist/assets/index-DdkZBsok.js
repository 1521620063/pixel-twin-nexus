import{b as e,j as a,D as l,a5 as s,Z as t,n as i,X as n,y as c,W as o,Y as d,F as r,a6 as u,V as m,P as f,v as p,a3 as _}from"./vendor-bgb2fARM.js";import{_ as v,s as x,V as y,b,w as g,t as h,v as w,y as I,a as z,x as T,E as k,a6 as j,a7 as V,a8 as C,B as P,a3 as D,u as N}from"./index-BrAQZWud.js";import{V as S}from"./VSelect-hpT9jQ5K.js";import"./ui-DPCHhl7L.js";const A={class:"instance-management-view"},E={class:"d-flex align-center justify-space-between"},L={class:"d-flex align-center"},U={key:0,class:"text-center py-12"},B={key:1,class:"text-center py-12"},F={key:2,class:"text-center py-12"},G={key:3,class:"instances-grid"},W={class:"d-flex align-center mb-3"},X={class:"flex-grow-1"},Y={class:"text-subtitle-1 font-weight-bold mb-0 instance-title"},Z={class:"project-info mb-3"},$={class:"info-row mb-1"},q={class:"text-caption"},H={class:"server-info mb-3"},J={class:"info-row mb-1"},K={class:"text-caption"},M={class:"info-row mb-1"},O={class:"text-caption"},Q={class:"connection-info"},R={class:"info-row mb-1"},ee={class:"text-caption"},ae={class:"info-row mb-1"},le={class:"text-caption"},se={class:"info-row mb-1"},te={class:"text-caption"},ie={class:"info-row"},ne={class:"text-caption"},ce={__name:"index",setup(v){const ce=e(!1),oe=e(!1),de=e(!1),re=e("");let ue=null;const{confirmDelete:me}=D(),{showSuccess:fe,showError:pe}=N(),_e=e([]),ve=e([]),xe=e(1);e(20);const ye=e(0),be=async()=>{await ge(null,!0)},ge=async(e=null,a=!0)=>{const l=null!==e?e:re.value;a&&(de.value=!0);try{const e=await h.instance.getInstanceList({data:{pixelTwinId:l,page:1,pageSize:100}});200==e.code?(ve.value=(e.data?.list||[]).map(e=>({...e,destroying:!1})),ye.value=e.data?.total||0):ve.value=[]}catch(s){ve.value=[]}finally{a&&(de.value=!1)}},he=()=>{xe.value=1},we=()=>{ue&&(clearInterval(ue),ue=null)},Ie=e=>{if(!e)return"未知";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})};return a(re,e=>{ge(e)}),l(()=>{(async()=>{oe.value=!0;try{const e=await h.instance.getInstanceTypes();if(200==e.code){const a=e.data.list||[];_e.value=[{pixelTwinId:"",pixelTwinName:"全部"},...a],re.value="",await ge("")}else _e.value=[]}catch(e){_e.value=[]}finally{oe.value=!1}})(),we(),ue=setInterval(()=>{null===re.value||de.value||ge(null,!1)},5e3)}),s(()=>{we()}),(e,a)=>(o(),t("div",A,[i(x,{class:"page-header mb-6",elevation:"3"},{default:n(()=>[i(w,{class:"py-6"},{default:n(()=>[c("div",E,[c("div",L,[i(I,{size:"64",color:"primary",class:"mr-4"},{default:n(()=>[i(y,{size:"32",color:"white"},{default:n(()=>a[2]||(a[2]=[d("mdi-cube-outline")])),_:1,__:[2]})]),_:1}),a[3]||(a[3]=c("div",null,[c("h1",{class:"text-h4 font-weight-bold mb-1 text-primary"}," Pixel Twin 实例管理 "),c("p",{class:"text-body-1 text-medium-emphasis mb-0"}," 管理和监控 Pixel Twin 项目实例 ")],-1))]),i(z,{color:"primary",variant:"elevated","prepend-icon":"mdi-refresh",onClick:be,loading:ce.value,class:"refresh-btn"},{default:n(()=>a[4]||(a[4]=[d(" 刷新数据 ")])),_:1,__:[4]},8,["loading"])])]),_:1})]),_:1}),i(x,{class:"mb-6",elevation:"2"},{default:n(()=>[i(w,null,{default:n(()=>[i(g,{align:"center"},{default:n(()=>[i(T,{cols:"12",md:"6"},{default:n(()=>[i(S,{modelValue:re.value,"onUpdate:modelValue":[a[0]||(a[0]=e=>re.value=e),he],items:_e.value,"item-title":"pixelTwinName","item-value":"pixelTwinId",label:"选择项目类型",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-folder-outline",loading:oe.value,clearable:"","hide-details":""},{"no-data":n(()=>[i(k,null,{default:n(()=>[i(j,null,{default:n(()=>a[5]||(a[5]=[d("暂无项目类型")])),_:1,__:[5]})]),_:1})]),_:1},8,["modelValue","items","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),de.value||0!=ve.value.length?de.value?(o(),t("div",B,[i(b,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),a[9]||(a[9]=c("h3",{class:"text-h6 text-medium-emphasis"},"加载实例数据中...",-1))])):0===ve.value.length?(o(),t("div",F,[i(y,{size:"80",color:"grey-lighten-2",class:"mb-4"},{default:n(()=>a[10]||(a[10]=[d("mdi-cube-off-outline")])),_:1,__:[10]}),a[11]||(a[11]=c("h3",{class:"text-h6 text-medium-emphasis mb-2"},"暂无实例",-1)),a[12]||(a[12]=c("p",{class:"text-body-2 text-medium-emphasis"},"当前项目类型下没有运行的实例",-1))])):(o(),t("div",G,[i(g,null,{default:n(()=>[(o(!0),t(r,null,u(ve.value,e=>(o(),m(T,{key:e.id,cols:"12",sm:"6",md:"4",lg:"3"},{default:n(()=>[i(x,{class:"instance-card",elevation:"2",hover:""},{default:n(()=>[i(w,{class:"pb-2"},{default:n(()=>[c("div",W,[i(I,{size:"40",color:"primary",class:"mr-3"},{default:n(()=>[i(y,{color:"white"},{default:n(()=>a[13]||(a[13]=[d("mdi-cube-outline")])),_:1,__:[13]})]),_:1}),c("div",X,[c("h3",Y,"实例 "+f(e.id),1)]),i(V,null,{activator:n(({props:e})=>[i(z,p({icon:"mdi-dots-vertical",variant:"text",size:"small"},{ref_for:!0},e,{onClick:a[1]||(a[1]=_(()=>{},["stop"]))}),null,16)]),default:n(()=>[i(C,null,{default:n(()=>[i(k,{onClick:a=>(async e=>{if(await me(e.id,"实例")){e.destroying=!0;try{const a=await h.instance.destroyInstance({data:{pixelTwinId:e.pixelTwinId,instanceId:e.id}});if(200==a.code){const a=ve.value.findIndex(a=>a.id===e.id);-1!==a&&ve.value.splice(a,1),fe(`实例 "${e.id}" 已销毁`)}else pe(a.message||"销毁实例失败")}catch(a){pe("销毁实例失败，请稍后重试")}finally{e.destroying=!1}}})(e),disabled:e.destroying},{prepend:n(()=>[i(y,{color:"error"},{default:n(()=>a[14]||(a[14]=[d("mdi-delete")])),_:1,__:[14]})]),default:n(()=>[i(j,{class:"text-error"},{default:n(()=>a[15]||(a[15]=[d("销毁实例")])),_:1,__:[15]})]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1024)]),c("div",Z,[i(P,{color:"primary",variant:"tonal",size:"small",class:"mb-2"},{default:n(()=>[i(y,{start:"",size:"16"},{default:n(()=>a[16]||(a[16]=[d("mdi-folder")])),_:1,__:[16]}),d(" "+f(e.pixelTwinName),1)]),_:2},1024),c("div",$,[i(y,{size:"16",class:"mr-2",color:"info"},{default:n(()=>a[17]||(a[17]=[d("mdi-identifier")])),_:1,__:[17]}),c("span",q,"项目ID: "+f(e.pixelTwinId),1)])]),c("div",H,[c("div",J,[i(y,{size:"16",class:"mr-2",color:"secondary"},{default:n(()=>a[18]||(a[18]=[d("mdi-server")])),_:1,__:[18]}),c("span",K,"服务器: "+f(e.serverIp),1)]),c("div",M,[i(y,{size:"16",class:"mr-2",color:"warning"},{default:n(()=>a[19]||(a[19]=[d("mdi-graphics-card")])),_:1,__:[19]}),c("span",O,"GPU适配器: "+f(e.gpuAdapter),1)])]),c("div",Q,[c("div",R,[i(y,{size:"16",class:"mr-2",color:"info"},{default:n(()=>a[20]||(a[20]=[d("mdi-ip")])),_:1,__:[20]}),c("span",ee,"客户端IP: "+f(e.clientInfo?.ip||"未知"),1)]),c("div",ae,[i(y,{size:"16",class:"mr-2",color:"success"},{default:n(()=>a[21]||(a[21]=[d("mdi-connection")])),_:1,__:[21]}),c("span",le,"连接时间: "+f(Ie(e.clientInfo?.connectTime)),1)]),c("div",se,[i(y,{size:"16",class:"mr-2",color:"primary"},{default:n(()=>a[22]||(a[22]=[d("mdi-clock-outline")])),_:1,__:[22]}),c("span",te,"最后活跃: "+f(Ie(e.clientInfo?.lastActiveTime)),1)]),c("div",ie,[i(y,{size:"16",class:"mr-2",color:"purple"},{default:n(()=>a[23]||(a[23]=[d("mdi-web")])),_:1,__:[23]}),c("span",ne,"来源: "+f(e.clientInfo?.origin||"未知"),1)])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):(o(),t("div",U,[i(y,{size:"80",color:"grey-lighten-2",class:"mb-4"},{default:n(()=>a[6]||(a[6]=[d("mdi-folder-open-outline")])),_:1,__:[6]}),a[7]||(a[7]=c("h3",{class:"text-h6 text-medium-emphasis mb-2"},"请选择项目类型",-1)),a[8]||(a[8]=c("p",{class:"text-body-2 text-medium-emphasis"},"选择一个项目类型来查看其实例列表",-1))]))]))}},oe=v(ce,[["__scopeId","data-v-eeecb873"]]);export{oe as default};
